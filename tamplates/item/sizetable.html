<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>后台管理-尺码对照表</title>
    <link rel="stylesheet" href="../../static/css/common.css"/>
    <link rel="stylesheet" href="../../static/css/sizetable.css"/>
</head>
<body>
    <div class="pub-content">
        <div class="pub-right">
            <div class="pub-title-box">
                <div class="pub-title">尺码对照表</div>
            </div>
            <div class="pub-box-noborder">
                <a class="size-btn-newtable J_newTable" href="javascript:;">新建对照表</a>
                <div class="size-tab-nav">
                    <ul>
                        <li>
                            <input class="J_sizeTabNav" id="class1" type="radio" name="class">
                            <label for="class1">衬衣－第一批尺码对照</label>
                        </li>
                        <li>
                            <input class="J_sizeTabNav" id="class2" type="radio" name="class">
                            <label for="class2">T恤－第一批尺码对照</label>
                        </li>
                        <li>
                            <input class="J_sizeTabNav" id="class3" type="radio" name="class">
                            <label for="class3">外套－第一批尺码对照</label>
                        </li>
                    </ul>
                </div>
                <!-- 对照表 -->
                <div class="size-table-loading J_loading">Loading......</div>

                <div class="size-tab-con">
                    <div class="size-table-opration">
                        <a class="J_tableEdit" href="javascript:;">编辑</a>
                        <a class="J_tableSave" href="javascript:;">保存</a>
                        <a class="J_tableCanel" href="javascript:;">取消</a>
                    </div>
                    <div class="size-table-wrap clearfix J_tableWrap">
                        <div class="size-table-name">
                            <div class="J_tableData">衬衣－第一批尺码对照</div>
                            <label class="size-table-name-edit">修改名称:</label>
                            <input class="J_tableEditInput J_tableEditName" type="text"/>
                        </div>
                        <div class="size-table J_table">
                            <div class="size-table-th clearfix J_tableHead">
                                <div class="size-table-box">
                                    <span class="J_tableData">类型</span>
                                    <input class="size-table-input1 J_tableEditInput" type="text" >
                                </div>
                                <div class="size-table-box J_tableTit">
                                    <span class="J_tableData">袖长</span>
                                    <input class="size-table-input1 J_tableEditInput" type="text" >
                                    <a class="size-btn-delete J_delPara" href="javascript:;">×</a>
                                </div>
                            </div>
                            <div class="size-table-td clearfix J_tableBody">
                                <div class="size-table-box J_tableSize">
                                    <span class="J_tableData">S3</span>
                                    <input class="size-table-input1 J_tableEditInput" type="text" >
                                    <a class="size-btn-delete J_delSize" href="javascript:;">×</a>
                                </div>
                                <div class="size-table-box J_tableCon">
                                    <span class="J_tableData">30</span>
                                    <input class="size-table-input1 J_tableEditInput" type="text" >
                                </div>
                            </div>
                        </div>
                        <a class="size-btn-addpara J_addPara" href="javascript:;">添加属性</a>
                    </div>
                    <a class="size-btn-addsize J_addSize" href="javascript:;">添加类型</a>
                </div>

                <div class="size-tab-con">
                    <div class="size-table-opration">
                        <a class="J_tableEdit" href="javascript:;">编辑</a>
                        <a class="J_tableSave" href="javascript:;">保存</a>
                        <a class="J_tableCanel" href="javascript:;">取消</a>
                    </div>
                    <div class="size-table-wrap clearfix J_tableWrap">
                        <div class="size-table-name">
                            <div class="J_tableData">T恤－第一批尺码对照</div>
                            <label class="size-table-name-edit">修改名称:</label>
                            <input class="J_tableEditInput J_tableEditName" type="text"/>
                        </div>
                        <div class="size-table J_table">
                            <div class="size-table-th clearfix J_tableHead">
                                <div class="size-table-box">
                                    <span class="J_tableData">类型</span>
                                    <input class="size-table-input1 J_tableEditInput" type="text" >
                                </div>
                                <div class="size-table-box J_tableTit">
                                    <span class="J_tableData">袖长</span>
                                    <input class="size-table-input1 J_tableEditInput" type="text" >
                                    <a class="size-btn-delete J_delPara" href="javascript:;">×</a>
                                </div>
                            </div>
                            <div class="size-table-td clearfix J_tableBody">
                                <div class="size-table-box J_tableSize">
                                    <span class="J_tableData">S3</span>
                                    <input class="size-table-input1 J_tableEditInput" type="text" >
                                    <a class="size-btn-delete J_delSize" href="javascript:;">×</a>
                                </div>
                                <div class="size-table-box J_tableCon">
                                    <span class="J_tableData">30</span>
                                    <input class="size-table-input1 J_tableEditInput" type="text" >
                                </div>
                            </div>
                        </div>
                        <a class="size-btn-addpara J_addPara" href="javascript:;">添加属性</a>
                    </div>
                    <a class="size-btn-addsize J_addSize" href="javascript:;">添加类型</a>
                </div>

                <div class="size-tab-con">
                    <div class="size-table-opration">
                        <a class="J_tableEdit" href="javascript:;">编辑</a>
                        <a class="J_tableSave" href="javascript:;">保存</a>
                        <a class="J_tableCanel" href="javascript:;">取消</a>
                    </div>
                    <div class="size-table-wrap clearfix J_tableWrap">
                        <div class="size-table-name">
                            <div class="J_tableData">外套－第一批尺码对照</div>
                            <label class="size-table-name-edit">修改名称:</label>
                            <input class="J_tableEditInput J_tableEditName" type="text"/>
                        </div>
                        <div class="size-table J_table">
                            <div class="size-table-th clearfix J_tableHead">
                                <div class="size-table-box">
                                    <span class="J_tableData">类型</span>
                                    <input class="size-table-input1 J_tableEditInput" type="text" >
                                </div>
                                <div class="size-table-box J_tableTit">
                                    <span class="J_tableData">袖长</span>
                                    <input class="size-table-input1 J_tableEditInput" type="text" >
                                    <a class="size-btn-delete J_delPara" href="javascript:;">×</a>
                                </div>
                            </div>
                            <div class="size-table-td clearfix J_tableBody">
                                <div class="size-table-box J_tableSize">
                                    <span class="J_tableData">S3</span>
                                    <input class="size-table-input1 J_tableEditInput" type="text" >
                                    <a class="size-btn-delete J_delSize" href="javascript:;">×</a>
                                </div>
                                <div class="size-table-box J_tableCon">
                                    <span class="J_tableData">30</span>
                                    <input class="size-table-input1 J_tableEditInput" type="text" >
                                </div>
                            </div>
                        </div>
                        <a class="size-btn-addpara J_addPara" href="javascript:;">添加属性</a>
                    </div>
                    <a class="size-btn-addsize J_addSize" href="javascript:;">添加类型</a>
                </div>

                <!-- 对照表 end -->
            </div>
        </div>
    </div>
    <div class="pop-mask" id="J_popMask"></div>
    <div class="pop1 size-pop1 J_pop" id="pop_addPara">
        <p class="size-pop-con1"><span>属性名:</span><input id="addParaName" type="text" value=""></p>
        <div class="size-pop-btnbox">
            <a class="size-pop-btn1 J_submitAddPara" href="javascript:;">确定</a>
            <a class="size-pop-btn2 J_popClose" href="javascript:;">取消</a>
        </div>
    </div>
    <div class="pop1 size-pop1 J_pop" id="pop_addSize">
        <p class="size-pop-con1"><span>类型名:</span><input id="addSizeName" type="text" value=""></p>
        <div class="size-pop-btnbox">
            <a class="size-pop-btn1 J_submitAddSize" href="javascript:;">确定</a>
            <a class="size-pop-btn2 J_popClose" href="javascript:;">取消</a>
        </div>
    </div>
    <div class="pop1 size-pop1 J_pop" id="pop_addTable">
        <p class="size-pop-con1"><span>模板名:</span><input type="text" value=""></p>
        <div class="size-pop-btnbox">
            <a class="size-pop-btn1" href="javascript:;">确定</a>
            <a class="size-pop-btn2 J_popClose" href="javascript:;">取消</a>
        </div>
    </div>
<script src="../../static/js/jquery-1.11.3.min.js"></script>
<script>
(function($){
    var pop = {
        init:function(){
            var _this = this;
            $('body').on('click','.J_popClose',function(){
                _this.popHide();
            });
        },
        popShow:function(el) {
            var _this = this;
            $(el).show();
            _this.maskShow();
        },
        popHide:function(el){
            var _this = this;
            var _el = el || '.J_pop';
            $(_el).hide();
            $('#J_popMask').hide();
        },
        maskShow:function(){
            var _this = this;
            if($('#J_popMask').length){
                $('#J_popMask').show();
            }else{
                $('body').append('<div class="pop-mask" id="J_popMask" style="position: fixed;top: 0;left: 0;width: 100%;height: 100%;background-color: #333;opacity: .6;display: none;"></div>');
                $('#J_popMask').show();
            }
        }
    }

    var sizeTable = {
        tableBackup:'',
        init:function(){
            var _this = this; 
            _this.bindEv();
            _this.sizeTab();
            pop.init();
        },
        bindEv:function(){
            var _this = this;
            $('.J_tableEdit').on('click',function(e){
                var _tpp = $(e.target).parent().parent();
                _tpp.addClass("editing");
                //开启编辑模式
                _this.editStart();
                //备份
                _this.backup();


            });
            $('.J_addPara').on('click',function(e){
                pop.popShow('#pop_addPara');
            });
            $('.J_addSize').on('click',function(e){
                pop.popShow('#pop_addSize');
            });
            $('.J_table').on('click','.J_delPara',function(e){
                var _n = $(e.target).parent().index()-1;
                _this.deletePara(_n);
            });
            $('.J_table').on('click','.J_delSize',function(e){
                var _n = $(e.target).parent().parent().index()-1;
                _this.deleteSize(_n);
            });
            $('.J_submitAddPara').on('click',function(){
                var _paraName = $('#addParaName').val();
                if(_paraName != ''){
                    _this.addPara(_paraName);
                }else{
                    alert('请输入属性名');
                }
            });
            $('.J_submitAddSize').on('click',function(){
                var _sizeName = $('#addSizeName').val();
                if(_sizeName != ''){
                    _this.addSize(_sizeName);
                }else{
                    alert('请输入类型名');
                }
            });
            $('.J_tableSave').on('click',function(e){
                _this.editSave();
            });
            $('.J_tableCanel').on('click',function(e){
                _this.editCanel();

            });
            $('.J_newTable').on('click',function(e){
                pop.popShow('#pop_addTable');
            });
        },
        sizeTab:function(){
            var _this = this; 
            $('.J_sizeTabNav').each(function(i,e){
                $(e).on('change',function(){
                    var _con = $('.size-tab-con');
                    if(_con.hasClass('editing')){
                        if(_this.editCanel()){
                            _con.hide();
                            // con show
                            if(_con.eq(i).hasClass('loaded')){
                                _con.eq(i).show();
                            }else{
                                _con.eq(i).addClass('loaded');
                                $('.J_loading').show();
                                //ajax success
                                //load data

                                $('.J_loading').hide();
                                _con.eq(i).show();
                            };
                        }else{
                            _con.each(function(j,f){
                                if($(f).hasClass('editing')){
                                    $(e).removeAttr('checked');
                                    $('.J_sizeTabNav').eq(j).prop("checked","checked");;
                                };
                            });
                            return false;
                        }
                    }else{
                        _con.hide();
                        // con show
                        if(_con.eq(i).hasClass('loaded')){
                            _con.eq(i).show();
                        }else{
                            _con.eq(i).addClass('loaded');
                            $('.J_loading').show();
                            //ajax success
                            //load data
                            $('.J_loading').hide();
                            _con.eq(i).show();
                        };
                    }
                });
            });
        },
        editStart:function(){
            var _this = this; 
            var editInput = $('.J_tableEditInput','.editing');
            editInput.each(function(i,e){
                var _data = $(e).siblings('.J_tableData').html();
                $(e).siblings('.J_tableData');
                $(e).val(_data);
            });
            $('.J_sizeTabNav').each(function(i,e){
                if(e.checked){
                    $(e).siblings('label').addClass('nameEdit');
                };
            });
        },
        editSave:function(){
            var _this = this;
            var editInput = $('.J_tableEditInput','.editing');
            editInput.each(function(i,e){
                var _data = $(e).val();
                $(e).siblings('.J_tableData').html(_data);
            });
            //get data
            var _id = '1';
            var _name = $('.size-table-name .J_tableData','.editing').html();
            var _value = [];
            var _thValue =[];
            $('.J_tableHead .J_tableData','.editing').each(function(i,e){
                _thValue.push($(e).html());
            });
            _value.push(_thValue);
            $('.J_tableBody','.editing').each(function(i,e){
                var _tbValue = [];
                $('.J_tableData',e).each(function(j,f){
                    _tbValue.push($(f).html());
                });
            _value.push(_tbValue);
            });
            var _data = {
                "id" : _id,
                "name" : _name,
                "value" : _value
            }
            // $.ajax({
            //     type: "POST",
            //     url: "",
            //     data: JSON.stringify(_data),
            //     dataType: "json",
            //     contentType: "application/json; charset=utf-8",
            //     success: function(data){
            //         console.log(data);
            //     },
            //     error: function(res){
            //         console.log(res);
            //     }
            // });
            //ajax success
            $('.nameEdit').html($('.J_tableEditName','.editing').val());
            $('.nameEdit').removeClass('nameEdit');
            $('.editing').removeClass('editing');
            alert('保存成功');
        },
        editCanel:function(){
            var _this = this; 

            if(confirm("未保存的数据将丢失")){
                var editInput = $('.J_tableEditInput','.editing');
                //还原
                $('.J_table','.editing').html(_this.tableBackup);
                $('.editing').removeClass('editing');
                $('.nameEdit').removeClass('nameEdit');
                return true;
            }else{
                return false;
            }

        },
        addPara:function(paraName){
            var _this = this; 
            $('.J_tableHead','.editing').append('<div class="size-table-box J_tableTit">'+
                                                    '<span class="J_tableData">'+ paraName +'</span>'+
                                                    '<input class="size-table-input1 J_tableEditInput" type="text" value="'+ paraName +'" >'+
                                                    '<a class="size-btn-delete J_delPara" href="javascript:;">×</a>'+
                                                '</div>');
            $('.J_tableBody','.editing').each(function(i,e){
                $(e).append('<div class="size-table-box J_tableCon">'+
                                    '<span class="J_tableData"></span>'+
                                    '<input class="size-table-input1 J_tableEditInput" type="text" >'+
                                '</div>');
            });
            pop.popHide();
            $('#addParaName').val('');
        },
        addSize:function(sizeName){
            var _this = this; 
            var tableConHtml = '';
            var paraLength = $('.J_tableTit','.editing').length;
            var conHtml = '<div class="size-table-box J_tableCon">'+
                                '<span class="J_tableData"></span>'+
                                '<input class="size-table-input1 J_tableEditInput" type="text" >'+
                            '</div>';
            for (var i = 0; i < paraLength; i++) {
                tableConHtml += conHtml;
            };

            var addHtml = '<div class="size-table-td clearfix J_tableBody">'+
                                '<div class="size-table-box J_tableSize">'+
                                    '<span class="J_tableData">'+ sizeName +'</span>'+
                                    '<input class="size-table-input1 J_tableEditInput" type="text" value="'+ sizeName +'" >'+
                                    '<a class="size-btn-delete J_delSize" href="javascript:;">×</a>'+
                                '</div>'+ tableConHtml +
                            '</div>';
            $('.J_table','.editing').append(addHtml);
            pop.popHide();
            $('#addSizeName').val('');
        },
        deletePara:function(n){
            var _this = this;
            if($('.J_tableTit','.editing').length<2){
                alert('至少需要一个属性');
                return false;
            }
            if(confirm("确认删除")){
                $('.J_tableTit','.editing').eq(n).remove();
                $('.J_tableBody','.editing').each(function(i,e){
                    $('.J_tableCon',e).eq(n).remove();
                });
            }else{
                return false;
            }

        },
        deleteSize:function(n){
            var _this = this; 
            if($('.J_tableBody','.editing').length<2){
                alert('至少需要一个类型');
                return false;
            }
            if(confirm("确认删除")){
                $('.J_tableBody','.editing').eq(n).remove();
            }else{
                return false;
            }

        },
        backup:function(){
            var _this = this; 
            var backuphtml = $('.J_table','.editing').html();
            _this.tableBackup = backuphtml;
        }
    }

    sizeTable.init();
})(jQuery)
</script>
</body>
</html>